### 疑问

提出这个问题，来源于一个疑问。

隔离级别可重复读(RR)下的数据读取不受其他事务影响，即使其他事务提交了对当前行的修改，当前事务中读取的数据依然是数据进入事务时的快照状态。

那么在RR隔离级别下基于version字段的乐观锁的实现还有效吗？

### 结论

1. RR隔离级别对比RC级别，在事务开始时创建了一个包含所有已提交事务的一致性读取视图，在当前事务中读取的是快照中的数据，事务中的修改也会即时反映到快照中。
2. RR隔离级别中，写操作如(UPDATE/DELETE)中的WHERE条件并不在一致性快照中进行，也就是读和写WHERE条件数据范围可能是不一样的
3. 基于以上，乐观锁在RR和RC级别都可以实现，因为UPDATE/DELETE的WHERE条件的数据范围都包含了自身和其他事务已提交的变更，反映的是数据的真实情况

### ChatGPT对话记录

https://sharegpt.com/c/HlSpQdT
